<template>
    <div class="collection-title">
        <svg style="margin-bottom: 10px; stroke: #6b9bd2;" xmlns="http://www.w3.org/2000/svg" fill="#000000" width="30px" height="30px" viewBox="0 0 16 16" id="request-send-16px"><path id="Path_44" data-name="Path 44" d="M-18,11a2,2,0,0,0,2-2,2,2,0,0,0-2-2,2,2,0,0,0-2,2A2,2,0,0,0-18,11Zm0-3a1,1,0,0,1,1,1,1,1,0,0,1-1,1,1,1,0,0,1-1-1A1,1,0,0,1-18,8Zm2.5,4h-5A2.5,2.5,0,0,0-23,14.5,1.5,1.5,0,0,0-21.5,16h7A1.5,1.5,0,0,0-13,14.5,2.5,2.5,0,0,0-15.5,12Zm1,3h-7a.5.5,0,0,1-.5-.5A1.5,1.5,0,0,1-20.5,13h5A1.5,1.5,0,0,1-14,14.5.5.5,0,0,1-14.5,15ZM-7,2.5v5A2.5,2.5,0,0,1-9.5,10h-2.793l-1.853,1.854A.5.5,0,0,1-14.5,12a.493.493,0,0,1-.191-.038A.5.5,0,0,1-15,11.5v-2a.5.5,0,0,1,.5-.5.5.5,0,0,1,.5.5v.793l1.146-1.147A.5.5,0,0,1-12.5,9h3A1.5,1.5,0,0,0-8,7.5v-5A1.5,1.5,0,0,0-9.5,1h-7A1.5,1.5,0,0,0-18,2.5v3a.5.5,0,0,1-.5.5.5.5,0,0,1-.5-.5v-3A2.5,2.5,0,0,1-16.5,0h7A2.5,2.5,0,0,1-7,2.5Zm-7.854,3.646L-12.707,4H-14.5a.5.5,0,0,1-.5-.5.5.5,0,0,1,.5-.5h3a.5.5,0,0,1,.191.038.506.506,0,0,1,.271.271A.5.5,0,0,1-11,3.5v3a.5.5,0,0,1-.5.5.5.5,0,0,1-.5-.5V4.707l-2.146,2.147A.5.5,0,0,1-14.5,7a.5.5,0,0,1-.354-.146A.5.5,0,0,1-14.854,6.146Z" transform="translate(23)"/></svg>
        Your book Requests</div>
    <div class="collection-container">
        <div class="active-requests-container">
            <div class="collection-title">
                <svg style="margin-bottom: 10px; stroke: #6b9bd2;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35px" height="35px" viewBox="0 0 24 24" version="1.1"><g id="ðŸ”-Product-Icons" stroke="#6b9bd2" stroke-width="1" fill="none" fill-rule="evenodd"><g id="ic_fluent_shifts_pending_24_regular" fill="#212121" fill-rule="nonzero"><path d="M6.5,12 C9.53756612,12 12,14.4624339 12,17.5 C12,20.5375661 9.53756612,23 6.5,23 C3.46243388,23 1,20.5375661 1,17.5 C1,14.4624339 3.46243388,12 6.5,12 Z M6.5,19.88 C6.15509206,19.88 5.87548893,20.1596031 5.87548893,20.5045111 C5.87548893,20.849419 6.15509206,21.1290221 6.5,21.1290221 C6.84490794,21.1290221 7.12451107,20.849419 7.12451107,20.5045111 C7.12451107,20.1596031 6.84490794,19.88 6.5,19.88 Z M17.75,3 C19.5449254,3 21,4.45507456 21,6.25 L21,17.75 C21,19.5449254 19.5449254,21 17.75,21 L11.9774077,21.0012092 C12.2742498,20.5377831 12.5138894,20.0341997 12.6863646,19.5004209 L17.75,19.5 C18.7164983,19.5 19.5,18.7164983 19.5,17.75 L19.5,6.25 C19.5,5.28350169 18.7164983,4.5 17.75,4.5 L6.25,4.5 C5.28350169,4.5 4.5,5.28350169 4.5,6.25 L4.49957906,11.3136354 C3.96580034,11.4861106 3.46221691,11.7257502 2.99879075,12.0225923 L3,6.25 C3,4.45507456 4.45507456,3 6.25,3 L17.75,3 Z M6.5000438,14.0030924 C5.45209485,14.0030924 4.63575024,14.8204841 4.64666418,15.9573825 C4.64931495,16.2335122 4.87531114,16.4552106 5.15144079,16.4525598 C5.42757044,16.449909 5.64926888,16.2239129 5.6466181,15.9477832 C5.64105975,15.3687734 6.00627225,15.0030924 6.5000438,15.0030924 C6.97241724,15.0030924 7.35344646,15.3949794 7.35344646,15.9525829 C7.35344646,16.1768805 7.27815856,16.343747 7.03551615,16.6299729 L6.93650069,16.7432479 L6.67112833,17.0333231 C6.18682267,17.5748716 6.0000438,17.9254825 6.0000438,18.5006005 C6.0000438,18.7767429 6.22390142,19.0006005 6.5000438,19.0006005 C6.77618617,19.0006005 7.0000438,18.7767429 7.0000438,18.5006005 C7.0000438,18.268353 7.07645293,18.0980788 7.32379001,17.8062547 L7.42473827,17.6907646 L7.69048308,17.400276 C8.16815154,16.8660369 8.35344646,16.5185919 8.35344646,15.9525829 C8.35344646,14.8488849 7.5310877,14.0030924 6.5000438,14.0030924 Z M11.75,6 C12.1296958,6 12.443491,6.28215388 12.4931534,6.64822944 L12.5,6.75 L12.5,12 L16.2482627,12 C16.6624763,12 16.9982627,12.3357864 16.9982627,12.75 C16.9982627,13.1296958 16.7161089,13.443491 16.3500333,13.4931534 L16.2482627,13.5 L11.75,13.5 C11.3703042,13.5 11.056509,13.2178461 11.0068466,12.8517706 L11,12.75 L11,6.75 C11,6.33578644 11.3357864,6 11.75,6 Z" id="ðŸŽ¨-Color"></path></g></g></svg>
                Pending Requests</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Sl.no</th>
                            <th>Book name</th>
                            <th>Requested on</th>
                            <th>Return date</th>
                            <th>Stutus</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(request, index) in requests" :key="request.id">
                            <td>{{ index+1 }}</td><td>{{ request.book_name }}</td><td>{{ formatISODate(request.created_datetime) }}</td><td>{{ formatISODate(request.end_datetime) }}</td>
                            <td>Pending</td>
                            <td @click="toggleEditRequest" style="cursor: pointer;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="25px" height="25px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M21.1213 2.70705C19.9497 1.53548 18.0503 1.53547 16.8787 2.70705L15.1989 4.38685L7.29289 12.2928C7.16473 12.421 7.07382 12.5816 7.02986 12.7574L6.02986 16.7574C5.94466 17.0982 6.04451 17.4587 6.29289 17.707C6.54127 17.9554 6.90176 18.0553 7.24254 17.9701L11.2425 16.9701C11.4184 16.9261 11.5789 16.8352 11.7071 16.707L19.5556 8.85857L21.2929 7.12126C22.4645 5.94969 22.4645 4.05019 21.2929 2.87862L21.1213 2.70705ZM18.2929 4.12126C18.6834 3.73074 19.3166 3.73074 19.7071 4.12126L19.8787 4.29283C20.2692 4.68336 20.2692 5.31653 19.8787 5.70705L18.8622 6.72357L17.3068 5.10738L18.2929 4.12126ZM15.8923 6.52185L17.4477 8.13804L10.4888 15.097L8.37437 15.6256L8.90296 13.5112L15.8923 6.52185ZM4 7.99994C4 7.44766 4.44772 6.99994 5 6.99994H10C10.5523 6.99994 11 6.55223 11 5.99994C11 5.44766 10.5523 4.99994 10 4.99994H5C3.34315 4.99994 2 6.34309 2 7.99994V18.9999C2 20.6568 3.34315 21.9999 5 21.9999H16C17.6569 21.9999 19 20.6568 19 18.9999V13.9999C19 13.4477 18.5523 12.9999 18 12.9999C17.4477 12.9999 17 13.4477 17 13.9999V18.9999C17 19.5522 16.5523 19.9999 16 19.9999H5C4.44772 19.9999 4 19.5522 4 18.9999V7.99994Z" fill="#6b9bd2"/></svg>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <br>
        <div class="completed-requests-container">
            <div class="collection-title">
                <svg style="margin-bottom: 10px; stroke: #6b9bd2;" xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 32 32" data-name="Layer 1" id="Layer_1"><defs></defs><title/><path class="cls-1" d="M9.22,12.38,5.92,16.5,3.71,14.29a1,1,0,0,0-1.42,1.42l3,3A1,1,0,0,0,6,19h.06a1,1,0,0,0,.72-.38l4-5a1,1,0,1,0-1.56-1.24Z"/><path class="cls-1" d="M9.22,2.38,5.92,6.5,3.71,4.29A1,1,0,0,0,2.29,5.71l3,3A1,1,0,0,0,6,9h.06a1,1,0,0,0,.72-.38l4-5A1,1,0,1,0,9.22,2.38Z"/><path class="cls-1" d="M14,7H29a1,1,0,0,0,0-2H14a1,1,0,0,0,0,2Z"/><path class="cls-1" d="M29,15H14a1,1,0,0,0,0,2H29a1,1,0,0,0,0-2Z"/><path class="cls-1" d="M29,25H14a1,1,0,0,0,0,2H29a1,1,0,0,0,0-2Z"/><path class="cls-1" d="M9.71,21.29a1,1,0,0,0-1.42,0L6,23.59l-2.29-2.3a1,1,0,0,0-1.42,1.42L4.59,25l-2.3,2.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L6,26.41l2.29,2.3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42L7.41,25l2.3-2.29A1,1,0,0,0,9.71,21.29Z"/></svg>
                Processed Requests</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Sl.no</th>
                            <th>Book name</th>
                            <th>Requested on</th>
                            <th>Return date</th>
                            <th>Stutus</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(request, index) in requests" :key="request.id">
                            <td>{{ index+1 }}</td><td>{{ request.book_name }}</td><td>{{ formatISODate(request.created_datetime) }}</td><td>{{ formatISODate(request.end_datetime) }}</td><td>{{request.status}}</td>
                            <td @click="toggleDelete" style="cursor: pointer;">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="red" width="20px" height="20px" viewBox="0 0 24 24"><path d="M5.755,20.283,4,8H20L18.245,20.283A2,2,0,0,1,16.265,22H7.735A2,2,0,0,1,5.755,20.283ZM21,4H16V3a1,1,0,0,0-1-1H9A1,1,0,0,0,8,3V4H3A1,1,0,0,0,3,6H21a1,1,0,0,0,0-2Z"/></svg>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <editRequest v-if="edit" :toggleEditRequest="toggleEditRequest"/>
    <deletePopup v-if="delete" @cancel="toggleDelete" />

</template>

<script>
import axiosClient from '@/services/axios';

import editRequest from '@/components/requests/editRequest.vue'
import deletePopup from '@/components/layout/delete.vue'

export default {
    data(){return{
        edit: false, delete: false,
        requests: [
            {
                "id": 2,
                "user_id": 2,
                "book_id": 4,
                "status": "issued",
                "created_datetime": "2024-03-20T04:11:59",
                "end_datetime": "2024-04-07T11:39:21",
                "read": false,
                "book_name": "How to Win Friends and Influence People"
            },
            {
                "id": 2,
                "user_id": 2,
                "book_id": 4,
                "status": "issued",
                "created_datetime": "2024-03-20T04:11:59",
                "end_datetime": "2024-04-07T11:39:21",
                "read": false,
                "book_name": "How to Win Friends and Influence People"
            },
            {
                "id": 2,
                "user_id": 2,
                "book_id": 4,
                "status": "issued",
                "created_datetime": "2024-03-20T04:11:59",
                "end_datetime": "2024-04-07T11:39:21",
                "read": false,
                "book_name": "How to Win Friends and Influence People"
            },
            {
                "id": 2,
                "user_id": 2,
                "book_id": 4,
                "status": "issued",
                "created_datetime": "2024-03-20T04:11:59",
                "end_datetime": "2024-04-07T11:39:21",
                "read": false,
                "book_name": "How to Win Friends and Influence People"
            },
            {
                "id": 2,
                "user_id": 2,
                "book_id": 4,
                "status": "issued",
                "created_datetime": "2024-03-20T04:11:59",
                "end_datetime": "2024-04-07T11:39:21",
                "read": false,
                "book_name": "How to Win Friends and Influence People"
            }
        ],
    }},
    methods: {
        fetchRequests() {
            setTimeout(()=>{
                axiosClient.get(`/api/requests`)
                .then(resp=>{
                    console.log(resp.data)
                })
            },2000)
        },
        formatISODate(isoDate) {
            const date = new Date(isoDate);
            return date.toLocaleDateString();
        },
        toggleEditRequest(){
            this.edit=!this.edit
        },
        toggleDelete(){
            this.delete=!this.delete
        }
    },
    mounted(){
        this.fetchRequests()
    },
    components: {
        editRequest, deletePopup
    }
}

</script>

<style scoped>
.collection-title {
    font-size: 20px;
    font-weight: 700;
    padding: 10px 10px;
    display: flex; align-items: center; gap: 6px;
}
.collection-container {
    flex: 1; overflow: auto;
}
/* table collection styling */
.active-requests-container .collection-title, .completed-requests-container .collection-title {
    padding-left: 25px;
}
.table-container {
    width: 100%;
    display: block; overflow-x: auto;
}
table {
    padding: 0 10px;
    width: 100%; 
}
table thead th {
    background-color: black;
    padding: 10px; font-size: 13px; font-weight: 500; color: gray;
}
table tbody tr {
    margin-bottom: 10px;
}
</style>